# MicroCloud Demo Project

This script automates the setup of a MicroCloud environment using LXD VMs. The Bash script initializes storage, networks, and VMs, configures the network settings, and sets up the MicroCloud using cloud-init.

## Prerequisites

Before running the script, ensure that you have the following installed and configured on your system:

- LXD (version 5.0 or later)
- ZFS (for storage pool management)
- Bash shell
- Certificates for LXD UI (`lxd-ui.crt`, `lxd-ui.pfx`) (OPTIONAL: Can be generated from the UI later)

### Initialize LXD

```bash
lxd init
```

Give atleast 30 GiB for the loop device storage.

## Project Structure

- **`config.sh`**: Configuration file containing environment-specific variables such as storage pool and network names.
- **`certs/`**: Directory containing SSL certificates for the LXD UI (`lxd-ui.crt` and `lxd-ui.pfx`). (OPTIONAL: Can be generated from the UI later)
- **`cleanup.sh`**: Script for cleaning up the MicroCloud environment, removing storage, networks, and VMs.
- **`my-microcloud-init.yaml`**: YAML configuration file generated by the script for initializing the MicroCloud.
- **`setup.sh`**: Main setup script that automates the creation of storage, networks, and VMs, and initializes the MicroCloud.

## Usage

### Step 1: Configure Environment

Update the `config.sh` file with your environment-specific settings, including the storage pool name, network name, and token for `ubuntu_pro`.

### Step 2: Run the Setup Script

To set up the MicroCloud environment, run the `setup.sh` script:

```bash
./setup.sh
```

#### What the Script Does

1. **Storage and Volume Creation:**

    - Creates a ZFS storage pool if it doesn't already exist.
    - Creates local and remote storage volumes.

2. **Network Configuration:**

    - Sets up the required network using LXD.

3. **VM Initialization:**

    - Initializes VMs (micro1, micro2, micro3) with cloud-init configurations.
    - Configures the network and storage for each VM.

4. **MicroCloud Initialization:**

    - Generates a my-microcloud-init.yaml file based on the configured IPs and network settings.
    - Pushes the YAML file to the primary VM (micro1) and initializes the MicroCloud using the `microcloud init --preseed` command.
    - Adds SSL certificates to the LXD configuration.

## Clean Up

To remove the MicroCloud setup, you can run the cleanup.sh script, which will remove all created resources (VMs, storage, networks).

```bash
./cleanup.sh
```